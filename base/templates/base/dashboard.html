{% extends 'base/main.html' %} 
{% block content %}
{% load static %}
<meta name="is_tier_one" content="{% if is_in_tier_one and clickedRecommendationTrueDashboard %}true{% else %}false{% endif %}">
<meta name="is_tier_two" content="{% if is_in_tier_two and clickedRecommendationTrueDashboard %}true{% else %}false{% endif %}">
<meta name="is_tier_three" content="{% if is_in_tier_three and clickedRecommendationTrueDashboard %}true{% else %}false{% endif %}">
<meta name="average_value" content="{{ average_value }}">

<link rel="stylesheet" type="text/css" href="{% static 'base/css/style.css' %}">
<script src="{% static 'base/js/dashboardBehavior.js' %}"></script>
<script src="{% static 'base/js/cardBehavior.js' %}"></script>
<script src="{% static 'base/js/recommendationBehavior.js' %}"></script>
{% load base_tags %}

<script src="{% static 'base/apexcharts-bundle/apexcharts.js' %}"></script>
<link rel="stylesheet" href="{% static 'base/apexcharts-bundle/apexcharts.css' %}">
<script src="{% static 'base/js/dashboardChartSetup.js' %}"></script>

<div class="content flex-1">
  <div class="row">
    <!-- Graph block -->
    <div class="col-12 col-lg-6">
      <div class="dashboard-card">
        <div class="dashboard-card-header-notclickable d-flex justify-content-between">
          Compliance level
          {% if has_data_to_export %}
          <a href="{% url 'reporter:GenerateOverallReport' %}" class="no-underline-link"> 
            <div>
              <i class="bi bi-printer color-icon-text white-underline" aria-hidden="true"></i>
              <span class="color-icon-text white-underline">{% if system_language == "en" %}Prepare a printout{% else %}Sagatavot izdruku{% endif %}
              </span>
            </div> 
          </a>
          {% endif %}
        </div>
        <div id="chart"></div>
      </div>
    </div>
    <!-- Category widget -->
    <div class="col-12 col-lg-6">
      <div class="dashboard-card">
        <div class="dashboard-card-header-notclickable d-flex justify-content-between">
          Audit results
        </div>
        <ul class="list-group list-group-flush">
          {% if categories %}
            {% if no_categories %}
            <li class="list-group-item dashboard-list-group-item">
              Track at least one audit category to see results here.           
              <br><br>
              <a href="{% url 'audit:Audits' %}">
                <button class="btn no-underline btn-to-audit">
                  Go to audits
                </button>
              </a>
            </li>
            {% else %}
              {% for category, data in sorted_categories_data.items %}

              <li class="list-group-item dashboard-list-group-item">
                <div class="d-flex justify-content-between">
                  <div>
                    {{ category }}
                  </div>
                  <div>{{ data.percentage }}%</div>
                </div>
                <div class="progress dashboard-progress">
                  <div class="progress-bar dashboard-progress-bar
                    {% if data.percentage|to_int < 33 %}bg-danger
                    {% elif data.percentage|to_int < 66 %}bg-warning
                    {% else %}bg-success
                    {% endif %}
                    width-{{ data.percentage|to_int }}"
                    role="progressbar"
                    aria-valuenow="{{ data.percentage|to_int }}"
                    aria-valuemin="0"
                    aria-valuemax="100">
                  </div>
                </div>
              </li>
              {% endfor %}
            {% endif %}
          {% else %}
            <li class="list-group-item dashboard-list-group-item">
              No topics found             
              <br><br>
              <a href="{% url 'audit:Audits' %}">
                <button class="btn no-underline btn-to-audit">
                  Go to audits
                </button>
              </a>
            </li>
          {% endif %}
        </ul>
      </div>
    </div>
  </div>
  <br />
  <!-- Full list of recommendations by priority -->
  <h4 class="text-center">
    Recommendation
  </h4>
  <div class="content flex-1">
    <div class="row">
      <div class="col-12">
        <!-- 1. priority card -->
        <div class="card dashboard-card">
          <div id="card-header-1" class="dashboard-card-header-1 dashboard-card-header-clickable">
            <span class="bi bi-plus-circle color-black"></span>
            <font color="#000000">1st priority</font>
          </div>
          <div id="nested-table-1" class="dashboard-nested-table display-none">
            {% include 'base/dashboard_nested_table.html' with no_recommendation=no_recommendation_1 recommendations=recommendation_list_tier_one recommendations_true=recommendation_list_tier_one_true has_accepted_cookies_client=has_accepted_cookies_client %}
          </div>
        </div>

        <!-- 2. priority card -->
        <div class="card dashboard-card">
          <div id="card-header-2" class="card-header dashboard-card-header-2 dashboard-card-header-clickable">
            <span class="bi bi-plus-circle color-black"></span>
            <font color="#000000">2nd priority</font>
          </div>
          <div id="nested-table-2" class="dashboard-nested-table display-none">
            {% include 'base/dashboard_nested_table.html' with no_recommendation=no_recommendation_2 recommendations=recommendation_list_tier_two recommendations_true=recommendation_list_tier_two_true  has_accepted_cookies_client=has_accepted_cookies_client %}
          </div>
        </div>
        
        <!-- 3. priority card -->
        <div class="card dashboard-card">
          <div id="card-header-3" class="dashboard-card-header-3 dashboard-card-header-clickable">
            <span class="bi bi-plus-circle color-black"></span>
            <font color="#000000">3rd priority</font>
          </div>
          <div id="nested-table-3" class="dashboard-nested-table display-none">
            {% include 'base/dashboard_nested_table.html' with no_recommendation=no_recommendation_3 recommendations=recommendation_list_tier_three recommendations_true=recommendation_list_tier_three_true has_accepted_cookies_client=has_accepted_cookies_client %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<br />
{% endblock %}
